import { useRef } from 'react';
import gsap from 'gsap';
import { useGSAP } from '@gsap/react';

gsap.registerPlugin(useGSAP);

export function PartyIllustration({ className }: { className?: string }) {
  const container = useRef<SVGSVGElement>(null);

  useGSAP(() => {
    // 1. Base Floating Animation for the entire illustration
    gsap.to(container.current, {
      y: -15,
      duration: 3,
      repeat: -1,
      yoyo: true,
      ease: 'sine.inOut'
    });

    // 2. Animate grouped elements together (Balloons + Highlights)
    const confettiElements = gsap.utils.toArray('.js-confetti');
    
    if (confettiElements.length > 0) {
      gsap.to(confettiElements, {
        y: 'random(-20, 20)',
        x: 'random(-15, 15)',
        rotation: 'random(-15, 15)',
        duration: 'random(3, 5)',
        repeat: -1,
        yoyo: true,
        ease: 'sine.inOut',
        stagger: {
          each: 0.2,
          from: "random"
        }
      });
    }

    // 3. Gentle pulse on the main figures or backdrops
    const pulseElements = gsap.utils.toArray('.js-pulse');
    if (pulseElements.length > 0) {
      gsap.to(pulseElements, {
        scale: 1.05,
        opacity: 0.8,
        duration: 2,
        repeat: -1,
        yoyo: true,
        ease: 'power1.inOut',
        transformOrigin: "center center"
      });
    }

  }, { scope: container });

  return (
    <svg 
      ref={container}
      className={`max-h-[80vh] w-auto drop-shadow-2xl ${className || ''}`}
      xmlns="http://www.w3.org/2000/svg" 
      viewBox="0 0 363.57 580.62" 
      role="img" 
      aria-hidden="true"
    >
      {/* Background/Base elements mapped to new colors */}
      <path className="js-pulse" d="M274.13324,123.04005c34.01485-2.40923,63.3055,25.16216,65.01362,58.82185,1.71356,33.76672-25.62287,99.49189-60.79196,110.88904,10.14603,17.39126-1.85144,12.85792-2.81444,14.6351-2.64246,19.63544,3.09855,187.00636,3.65878,206.45925-3.34782-2.44049-.82265-2.33193-.84433-2.533-1.97373-18.30813-6.27766-184.80258-3.94022-203.36337-24.10634.1081-3.71421-9.87626-5.066-15.76088-33.6776-20.02361-58.35624-87.85227-48.9713-124.39836,5.97681-23.27441,29.78856-43.05206,53.75585-44.74964Z" fill="#7A8C4A" opacity="0.4"/>
      
      {/* Structural Elements (Pants, Hair, Shadows) -> Mahogany / Dark Red */}
      <polygon points="175.61854 211.5374 170.01006 275.20841 223.14349 276.08981 218.02788 212.7565 175.61854 211.5374" fill="#4A1C0E"/>
      <path d="M189.79998,520.76548l-1.45883,25.94593-14.56813,21.18539s-13.52335-.03072-12.46169,7.58465l34.32503,1.99742,10.41344-14.35366-14.0722,14.91655h9.85055l1.97011-25.04854s-1.64116-10.67817-7.59899-11.82066l-4.22166-22.32506-14.8426,1.91797Z" fill="#4A1C0E"/>
      <path d="M270.45765,520.93117l2.49342,25.86702-11.18627,23.14992s-13.37155,2.0208-11.1671,9.38704l34.23086-3.23197,8.11585-15.76706.87154,14.95741,9.73658-1.49409-1.85194-25.05755s-3.24179-10.3057-9.30399-10.53131l-7.55899-21.42644-14.37997,4.14704Z" fill="#4A1C0E"/>
      <path d="M227.15812,318.8316s-23.09525,11.09307-46.15686,5.62889c0,0-14.75538,40.98816-10.04181,112.12884s2.72426,91.35536,2.72426,91.35536c0,0,19.11051,6.98645,42.21664-5.34744l-6.75466-65.01362,2.25155-72.89406,41.93519,148.60257s37.3251-2.79433,44.74964-10.69488l-30.03468-84.62175s-6.36876-62.95134-21.18818-83.68192l-19.7011-35.46198Z" fill="#4A1C0E"/>
      
      {/* Skin Tones / Highlights */}
      <path d="M235.55453,355.22752c-23.64119,0-25.61542-22.0492-25.63304-22.27556l1.26296-.09772c.06958.89063,1.9968,21.78696,25.52357,21.08806l.03835,1.26667c-.40202.01237-.80156.01855-1.19183.01855Z" fill="#6B3A2A"/>
      <path d="M202.04439,528.30599c-11.50764-89.35708-7.08667-192.98645-7.04059-194.02304l1.26543.0569c-.04608,1.03535-4.4621,104.55834,7.03131,193.80533l-1.25615.16081Z" fill="#6B3A2A"/>
      <path d="M285.08823,527.26816c-.44006-1.59076-44.1522-159.56197-57.68695-200.35639l1.20235-.39831c13.54433,40.8241,57.26545,198.82624,57.7055,200.41824l-1.2209.33646Z" fill="#6B3A2A"/>
      
      {/* Shirts/Dresses -> Rust & Gold */}
      <path d="M124.27646,303.28724l39.28094,16.83037-9.71551,10.82789-33.803-18.42755c-2.40969.93599-5.41428.86727-8.23074-.42569-4.92807-2.26235-7.40524-7.40249-5.53296-11.4809,1.87229-4.0784,7.385-5.5506,12.31308-3.28824,2.81647,1.29296,4.82714,3.52671,5.68819,5.96412Z" fill="#C4673A"/>
      <path d="M215.87976,223.57205c0-10.95877-8.88386-19.84264-19.84271-19.84264-10.95885,0-19.84271,8.88386-19.84271,19.84264,0,8.88757,5.84359,16.40943,13.89785,18.93563l3.83592,25.3509,19.5552-16.29593s-4.22456-5.38089-6.49008-11.44831c5.35458-3.55353,8.88653-9.63429,8.88653-16.54229Z" fill="#C4673A"/>
      <path d="M210.27147,248.47054s-7.49733,15.46962-18.19788,2.14761l-17.14561,2.85967s-1.61672,60.33238,4.94751,69.57545c0,0,25.93426,13.98033,47.28264-4.22166l-3.73454-66.66377-13.15211-3.69729Z" fill="#C9963A"/>
      <path d="M181.28271,255.78809l-6.35473-2.31027s-8.06809,1.21693-9.6782,7.71766c-1.61011,6.50073-11.00987,52.92924-11.00987,52.92924l-15.69979-4.21425-4.25861,13.49952s24.53798,15.3172,30.11474,7.66843,14.39984-42.75203,14.39984-42.75203l2.48662-32.5383Z" fill="#C9963A"/>
      <path d="M222.55885,317.42587l36.41783-22.36057,3.23357,14.18374-34.55995,16.96547c-.62667,2.50798-2.41716,4.92178-5.09873,6.47527-4.69206,2.71821-10.31929,1.7739-12.56885-2.10919-2.24955-3.88309-.26954-9.23443,4.42253-11.95264,2.68159-1.5535,5.66624-1.90595,8.1536-1.20208Z" fill="#C4673A"/>
      <path d="M218.73196,249.58233l13.95816.82026s42.01039,51.86658,30.96711,58.63513l-26.49444,15.76553-7.66149-12.94239,16.90395-9.6876-32.17324-34.40335,4.49995-18.18757Z" fill="#C9963A"/>
      <path d="M188.74676,207.21476s8.63008,19.3729,20.30212,22.14776l.46141,8.15161-15.94881,36.42761,41.69488-4.42749s-6.22814-93.10603-44.46247-72.14437c-24.41214,13.38375-15.73568,26.38576-15.73568,26.38576l13.68855-16.54087Z" fill="#4A1C0E"/>
      
      {/* Background Orbs / Confetti (Set to Gold) */}
      <g className="js-confetti" style={{transformOrigin: "center center"}}>
        {/* Large Gold Balloon */}
        <path d="M115.99929.12064c27.95577-1.98007,52.02886,20.68002,53.43272,48.34389,1.40832,27.75184-21.05866,81.76935-49.96306,91.13633,8.33871,14.29335-1.52165,10.56753-2.3131,12.02814-2.17175,16.13777,2.5466,223.36164,3.00704,239.34938-2.75147-2.00577-.67611-1.91654-.69393-2.08179-1.62215-15.0469-5.15942-221.55042-3.23835-236.80497-19.81227.08885-3.0526-8.117-4.16359-12.95339-27.67859-16.4568-47.96122-72.2031-40.24802-102.23923C76.73115,17.77048,96.3013,1.51583,115.99929.12064Z" fill="#C9963A" opacity="0.6"/>
        {/* Large Balloon Highlight */}
        <path d="M103.39983,13.65825c2.16927,1.25196-5.34185,3.65667-9.71504,7.40194-21.14053,18.10508-9.15041,62.92078-.92524,85.58487-11.62532-26.68032-24.19162-79.25104,10.64028-92.98681Z" fill="#FDF6E3" opacity="0.8"/>
      </g>
      
      <g className="js-confetti" style={{transformOrigin: "center center"}}>
        {/* Other floating blocks/rectangles grouped appropriately */}
        <rect x="27.34638" y="510.2726" width="115.26689" height="67.7668" fill="#C9963A" rx="4"/>
        <rect x="69.7798" y="509.54221" width="13.93336" height="67.86386" fill="#4A1C0E"/>
        <rect x="27.34641" y="524.27961" width="114.83426" height="1.26667" fill="#4A1C0E"/>
        <rect x="106.92947" y="510.86949" width="1.26667" height="68.10944" fill="#4A1C0E"/>
        <path d="M69.39745,511.05331c-3.05213-.71133-5.90318-2.26605-8.15415-4.44657-1.18126-1.14429-2.26123-2.67472-1.99808-4.29815.25435-1.56912,1.78255-2.72243,3.36226-2.89954s3.15708.45888,4.45745,1.37316,2.38208,2.0984,3.53073,3.19723c2.29822,2.19854,4.89844,4.08094,7.70468,5.57773" fill="#4A1C0E"/>
        <path d="M78.38696,509.53901c4.42882-2.14533,8.85763-4.29066,13.28645-6.43599.86246-.41778,1.74932-.84251,2.70405-.92536s2.00689.24974,2.51899,1.05975c.57808.91437.29534,2.17353-.38592,3.01385s-1.67797,1.35215-2.65372,1.81922c-2.87196,1.37477-5.82929,2.57117-8.84929,3.58001" fill="#4A1C0E"/>
      </g>

      {/* Floor / Ground line -> Mahogany/Olive */}
      <path d="M361.58794,580.62013H1.95532c-1.16524-.08906-2.02618-1.10215-1.95072-2.26739-.07546-1.15287.78548-2.16595,1.95072-2.25502h359.63261c1.02669.12617,1.83692.93763,1.96309,1.96309.16452,1.2543-.70879,2.39356-1.96309,2.55931Z" fill="#7A8C4A" opacity="0.4"/>
      
    </svg>
  );
}
